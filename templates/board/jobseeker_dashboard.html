{% extends "base.html" %}
{% block title %}My Dashboard · PT Jobs{% endblock %}
{% block content %}
<div class="container my-4">
  <h1 class="mb-3">Welcome, {{ jobseeker.full_name|default:jobseeker.email }}</h1>

  <!-- Tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#resumes" type="button" role="tab">My Resumes</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#applications" type="button" role="tab">My Applications</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#saved" type="button" role="tab">Saved Jobs</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#account" type="button" role="tab">Account Settings</button>
    </li>
  </ul>

  <div class="tab-content mt-3">
    <!-- Resumes -->
    <div class="tab-pane fade show active" id="resumes" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h4 class="mb-0">My Resumes</h4>
        <a href="{% url 'upload_resume' %}" class="btn btn-sm btn-primary">Upload</a>
      </div>
      {% if resumes %}
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead><tr><th>Title</th><th>Uploaded</th><th>File</th></tr></thead>
          <tbody>
          {% for r in resumes %}
            <tr>
              <td>{{ r.title }}</td>
              <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
              <td><a href="{{ r.file.url }}" target="_blank">Download</a></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p>No resumes yet. Click <strong>Upload</strong> to add one.</p>
      {% endif %}
    </div>

    <!-- Applications -->
    <div class="tab-pane fade" id="applications" role="tabpanel">
      <h4>My Applications</h4>
      {% if applications %}
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead><tr><th>Job</th><th>Employer</th><th>Submitted</th><th>Status</th></tr></thead>
          <tbody>
          {% for a in applications %}
            <tr>
              <td><a href="{% url 'job_detail' a.job.id %}">{{ a.job.title }}</a></td>
              <td>{{ a.job.employer.company_name|default:a.job.employer.name }}</td>
              <td>{{ a.created_at|date:"Y-m-d H:i" }}</td>
              <td>{{ a.get_status_display }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p>You haven’t applied to any jobs yet.</p>
      {% endif %}
    </div>

    <!-- Saved Jobs (uses aliases set in the view: s.employer, s.title, s.location, s.job_id) -->
    <div class="tab-pane fade" id="saved" role="tabpanel">
      <h4>Saved Jobs</h4>
      {% if saved_jobs %}
        <div class="list-group">
          {% for s in saved_jobs %}
          <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" href="{% url 'job_detail' s.job_id %}">
            <div>
              <div class="fw-semibold">{{ s.title }}</div>
              <div class="small text-muted">{{ s.employer.company_name|default:s.employer.name }} · {{ s.location }}</div>
            </div>
            <small class="text-muted">Saved {{ s.saved_at|date:"Y-m-d" }}</small>
          </a>
          {% endfor %}
        </div>
      {% else %}
        <p>No saved jobs yet.</p>
      {% endif %}
    </div>

    <!-- Account -->
    <div class="tab-pane fade" id="account" role="tabpanel">
      <h4>Account Settings</h4>
      <p><strong>Name:</strong> {{ jobseeker.full_name }}</p>
      <p><strong>Email:</strong> {{ jobseeker.email }}</p>
      <p><strong>Location:</strong> {{ jobseeker.current_location }}</p>
    </div>
  </div>
</div>
{% endblock %}
