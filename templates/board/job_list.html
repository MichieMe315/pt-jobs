{% extends "base.html" %}
{% block title %}Jobs · PT Jobs{% endblock %}
{% block content %}
<div class="container">
  <h1 class="mb-3">Jobs</h1>

  <form method="get" class="card card-body mb-3">
    <div class="row g-2">
      <div class="col-md-5">
        <input class="form-control" type="text" name="q" placeholder="Search job titles or descriptions" value="{{ q }}">
      </div>
      <div class="col-md-4">
        <input class="form-control" type="text" name="location" placeholder="City, province, or region" value="{{ location }}">
      </div>
      <div class="col-md-3">
        <select class="form-select" name="job_type">
          <option value="">All job types</option>
          <option value="full_time" {% if job_type == "full_time" %}selected{% endif %}>Full-time</option>
          <option value="part_time" {% if job_type == "part_time" %}selected{% endif %}>Part-time</option>
          <option value="contractor" {% if job_type == "contractor" %}selected{% endif %}>Contractor</option>
          <option value="resident" {% if job_type == "resident" %}selected{% endif %}>Resident</option>
          <option value="intern" {% if job_type == "intern" %}selected{% endif %}>Intern</option>
          <option value="locum" {% if job_type == "locum" %}selected{% endif %}>Locum</option>
        </select>
      </div>
    </div>
    <div class="mt-2 d-flex gap-2">
      <button class="btn btn-primary">Search</button>
      <a class="btn btn-outline-secondary" href="{% url 'job_list' %}">Reset</a>
    </div>
  </form>

  {% if jobs %}
    <div class="list-group">
      {% for job in jobs %}
        <a href="{% url 'job_detail' job.id %}" class="list-group-item list-group-item-action py-3">
          <div class="d-flex align-items-center gap-3">
            {% if job.employer.logo %}
              <img src="{{ job.employer.logo.url }}"
                   alt="{{ job.employer.company_name|default:job.employer.name }}"
                   style="width:56px;height:56px;object-fit:cover;border-radius:10px;flex:0 0 56px;">
            {% else %}
              <div style="width:56px;height:56px;border-radius:10px;background:#3a3f44;display:flex;align-items:center;justify-content:center;flex:0 0 56px;">
                <span class="text-muted small">No<br>Logo</span>
              </div>
            {% endif %}

            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <h5 class="mb-0">{{ job.title }}</h5>
                {% if job.featured %}<span class="badge text-bg-warning">Featured</span>{% endif %}
              </div>
              <div class="text-muted small mt-1">
                {{ job.employer.company_name|default:job.employer.name }} • {{ job.location }}
                • Posted {{ job.posting_date|date:"M j, Y" }} • Expires {{ job.expiry_date|date:"M j, Y" }}
              </div>

              <div class="mt-1">
                {# Hourly compensation #}
                {% if job.compensation_type == "hourly" %}
                  {% if job.salary_min or job.salary_max %}
                    <span class="badge text-bg-secondary">
                      ${{ job.salary_min|default_if_none:"" }}{% if job.salary_min and job.salary_max %}–{% endif %}{{ job.salary_max|default_if_none:"" }}/hour
                    </span>
                  {% endif %}
                {% endif %}

                {# Yearly compensation #}
                {% if job.compensation_type == "yearly" %}
                  {% if job.salary_min or job.salary_max %}
                    <span class="badge text-bg-secondary">
                      ${{ job.salary_min|default_if_none:"" }}{% if job.salary_min and job.salary_max %}–{% endif %}{{ job.salary_max|default_if_none:"" }}/year
                    </span>
                  {% endif %}
                {% endif %}

                {# Percent split #}
                {% if job.compensation_type == "percent" %}
                  {% if job.percent_split %}
                    <span class="badge text-bg-secondary">{{ job.percent_split }}% split</span>
                  {% endif %}
                {% endif %}

                {% if job.job_type %}
                  <span class="badge text-bg-secondary">{{ job.get_job_type_display }}</span>
                {% endif %}
              </div>
            </div>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">No jobs match your filters.</div>
  {% endif %}
</div>
{% endblock %}
