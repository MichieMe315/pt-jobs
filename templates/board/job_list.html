{% extends "base.html" %}
{% block title %}Jobs{% endblock %}
{% block content %}
<div class="container my-4">
  <!-- Full-width search bar -->
  <form method="get" class="row g-2 mb-4">
    <div class="col-12 col-md-6">
      <input type="text" class="form-control" name="q" value="{{ q }}" placeholder="Search keywords">
    </div>
    <div class="col-12 col-md-4">
      <input type="text" class="form-control" name="location" value="{{ location }}" placeholder="Location">
    </div>
    <div class="col-12 col-md-2 d-grid">
      <button class="btn btn-primary">Search</button>
    </div>
  </form>

  <div class="row">
    <!-- Main column: jobs -->
    <div class="col-lg-8">
      {% if jobs %}
        <ul class="list-group">
          {% for job in jobs %}
            <li class="list-group-item">
              <div class="d-flex align-items-start gap-3">
                {% if job.employer.logo %}
                  <img src="{{ job.employer.logo.url }}" alt="{{ job.employer.company_name|default:job.employer.name }}" width="56" height="56" class="rounded">
                {% else %}
                  <div class="bg-secondary rounded" style="width:56px;height:56px;"></div>
                {% endif %}
                <div class="flex-grow-1">
                  <h5 class="mb-1">
                    <a href="{% url 'job_detail' job.pk %}">{{ job.title }}</a>
                  </h5>
                  <div class="text-muted small mb-1">
                    {{ job.employer.company_name|default:job.employer.name }} · {{ job.location }}
                    {% if job.job_type %} · {{ job.get_job_type_display }}{% endif %}
                  </div>

                  <!-- Compensation pill -->
                  {% if job.compensation_type %}
                    <div class="mb-2">
                      <span class="badge bg-light text-dark border">
                        {% if job.compensation_type == "split" %}
                          {% if job.percent_split %}{{ job.percent_split|floatformat:-2 }}% split{% else %}Percent split{% endif %}
                        {% else %}
                          {% if job.salary_min %}${{ job.salary_min|floatformat:-2 }}{% endif %}
                          {% if job.salary_min and job.salary_max %} – {% endif %}
                          {% if job.salary_max %}${{ job.salary_max|floatformat:-2 }}{% endif %}
                          {{ job.get_compensation_type_display }}
                        {% endif %}
                      </span>
                      {% if job.relocation_assistance_provided %}
                        <span class="badge bg-success ms-1">Relocation assistance provided</span>
                      {% endif %}
                    </div>
                  {% endif %}

                  <p class="mb-0">{{ job.description|striptags|truncatechars:160 }}</p>
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No jobs found.</p>
      {% endif %}
    </div>

    <!-- Right column: Job Alerts -->
    <div class="col-lg-4">
      {% include "partials/job_alert_form.html" %}
    </div>
  </div>
</div>
{% endblock %}
