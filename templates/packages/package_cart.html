{% extends "base.html" %}
{% load currency %}
{% block title %}Your Cart · Physiotherapy Jobs Canada{% endblock %}

{% block content %}
<h1>Your Cart</h1>

{% if items %}
  <table style="width:100%;border-collapse:collapse;margin:12px 0;">
    <thead>
      <tr style="text-align:left;border-bottom:1px solid #243352;">
        <th style="padding:8px;">Package</th>
        <th style="padding:8px;">Price</th>
        <th style="padding:8px;">Qty</th>
        <th style="padding:8px;">Line Total</th>
        <th style="padding:8px;">Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for row in items %}
      <tr style="border-bottom:1px solid #243352;">
        <td style="padding:8px;">
          <strong>{{ row.pkg.name }}</strong><br>
          <small>Includes {{ row.pkg.job_post_limit }} posts · {{ row.pkg.duration_days }} days</small>
        </td>
        <td style="padding:8px;">{{ row.pkg.price_cents|cents_to_currency:row.pkg.currency }}</td>
        <td style="padding:8px;">
          <form method="post" action="{% url 'package_cart_update' row.pkg.code %}" style="display:inline-flex;gap:8px;align-items:center;">
            {% csrf_token %}
            <input type="number" name="quantity" min="1" value="{{ row.qty }}" style="width:80px;">
            <button class="btn-outline" type="submit">Update</button>
          </form>
        </td>
        <td style="padding:8px;">{{ row.line_total|cents_to_currency:row.pkg.currency }}</td>
        <td style="padding:8px;">
          <a class="btn-outline" href="{% url 'package_cart_remove' row.pkg.code %}">Remove</a>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

  <div style="text-align:right;margin-top:12px;">
    <div style="font-size:1.1rem;margin-bottom:12px;">
      <strong>Subtotal:</strong>
      {% if items %}{{ subtotal|cents_to_currency:items.0.pkg.currency }}{% else %}$0.00{% endif %}
    </div>
    <a class="btn" href="{% url 'package_checkout' %}">Proceed to Checkout</a>
  </div>
{% else %}
  <p>Your cart is empty.</p>
  <p><a class="btn" href="{% url 'package_list' %}">Browse Packages</a></p>
{% endif %}
{% endblock %}
